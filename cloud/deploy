#!/usr/bin/env bash

# Check if the database already has migrations table
if php artisan db:table-exists migrations; then
    # If migrations table exists, run migrations with --force
    echo "Running migrations on existing database..."
    php artisan migrate --force
else
    # If migrations table doesn't exist, run fresh migrations
    echo "Setting up fresh database..."
    php artisan migrate
fi

# Build frontend assets
echo "Building frontend assets..."
npm ci --no-audit
npm run build

# Run other deployment commands
php artisan config:cache
php artisan route:cache
php artisan view:cache
php artisan storage:link

# Output confirmation
echo "Deployment completed successfully!"
